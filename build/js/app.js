!function i(n,o,r){function a(t,e){if(!o[t]){if(!n[t]){var s="function"==typeof require&&require;if(!e&&s)return s(t,!0);if(h)return h(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}s=o[t]={exports:{}},n[t][0].call(s.exports,function(e){return a(n[t][1][e]||e)},s,s.exports,i,n,o,r)}return o[t].exports}for(var h="function"==typeof require&&require,e=0;e<r.length;e++)a(r[e]);return a}({1:[function(e,t,s){t.exports=function(e,t,s){this.onchange=null,this.xRot=0,this.yRot=0,this.zRot=0,this.scaleFactor=3,this.dragging=!1,this.curX=0,this.curY=0,t&&(this.canvas_=t),s&&(this.context_=s)}},{}],2:[function(e,t,s){function d(){this.elements=Array(16),this.loadIdentity()}d.prototype={scale:function(e,t,s){return this.elements[0]*=e,this.elements[1]*=e,this.elements[2]*=e,this.elements[3]*=e,this.elements[4]*=t,this.elements[5]*=t,this.elements[6]*=t,this.elements[7]*=t,this.elements[8]*=s,this.elements[9]*=s,this.elements[10]*=s,this.elements[11]*=s,this},translate:function(e,t,s){return this.elements[12]+=this.elements[0]*e+this.elements[4]*t+this.elements[8]*s,this.elements[13]+=this.elements[1]*e+this.elements[5]*t+this.elements[9]*s,this.elements[14]+=this.elements[2]*e+this.elements[6]*t+this.elements[10]*s,this.elements[15]+=this.elements[3]*e+this.elements[7]*t+this.elements[11]*s,this},rotate:function(e,t,s,i){var n,o,r,a,h,l,u=Math.sqrt(t*t+s*s+i*i),c=Math.sin(e*Math.PI/180),e=Math.cos(e*Math.PI/180);return 0<u&&(o=(t/=u)*t,r=(s/=u)*s,u=(i/=u)*i,a=t*s,h=s*i,l=i*t,t=t*c,s=s*c,i=i*c,c=1-e,(n=new d).elements[0]=c*o+e,n.elements[1]=c*a-i,n.elements[2]=c*l+s,n.elements[3]=0,n.elements[4]=c*a+i,n.elements[5]=c*r+e,n.elements[6]=c*h-t,n.elements[7]=0,n.elements[8]=c*l-s,n.elements[9]=c*h+t,n.elements[10]=c*u+e,n.elements[11]=0,n.elements[12]=0,n.elements[13]=0,n.elements[14]=0,n.elements[15]=1,n=n.multiply(this),this.elements=n.elements),this},frustum:function(e,t,s,i,n,o){var r,a=t-e,h=i-s,l=o-n;return n<=0||o<=0||a<=0||h<=0||l<=0||((r=new d).elements[0]=2*n/a,r.elements[1]=r.elements[2]=r.elements[3]=0,r.elements[5]=2*n/h,r.elements[4]=r.elements[6]=r.elements[7]=0,r.elements[8]=(t+e)/a,r.elements[9]=(i+s)/h,r.elements[10]=-(n+o)/l,r.elements[11]=-1,r.elements[14]=-2*n*o/l,r.elements[12]=r.elements[13]=r.elements[15]=0,r=r.multiply(this),this.elements=r.elements),this},perspective:function(e,t,s,i){e=Math.tan(e/360*Math.PI)*s,t*=e;return this.frustum(-t,t,-e,e,s,i)},ortho:function(e,t,s,i,n,o){var r=t-e,a=i-s,h=o-n,l=new d;return 0!=r&&0!=a&&0!=h&&(l.elements[0]=2/r,l.elements[12]=-(t+e)/r,l.elements[5]=2/a,l.elements[13]=-(i+s)/a,l.elements[10]=-2/h,l.elements[14]=-(n+o)/h,l=l.multiply(this),this.elements=l.elements),this},multiply:function(e){for(var t=new d,s=0;s<4;s++)t.elements[4*s+0]=this.elements[4*s+0]*e.elements[0]+this.elements[4*s+1]*e.elements[4]+this.elements[4*s+2]*e.elements[8]+this.elements[4*s+3]*e.elements[12],t.elements[4*s+1]=this.elements[4*s+0]*e.elements[1]+this.elements[4*s+1]*e.elements[5]+this.elements[4*s+2]*e.elements[9]+this.elements[4*s+3]*e.elements[13],t.elements[4*s+2]=this.elements[4*s+0]*e.elements[2]+this.elements[4*s+1]*e.elements[6]+this.elements[4*s+2]*e.elements[10]+this.elements[4*s+3]*e.elements[14],t.elements[4*s+3]=this.elements[4*s+0]*e.elements[3]+this.elements[4*s+1]*e.elements[7]+this.elements[4*s+2]*e.elements[11]+this.elements[4*s+3]*e.elements[15];return this.elements=t.elements,this},copy:function(){for(var e=new d,t=0;t<16;t++)e.elements[t]=this.elements[t];return e},get:function(e,t){return this.elements[4*e+t]},invert:function(){var e=this.get(2,2)*this.get(3,3),t=this.get(3,2)*this.get(2,3),s=this.get(1,2)*this.get(3,3),i=this.get(3,2)*this.get(1,3),n=this.get(1,2)*this.get(2,3),o=this.get(2,2)*this.get(1,3),r=this.get(0,2)*this.get(3,3),a=this.get(3,2)*this.get(0,3),h=this.get(0,2)*this.get(2,3),l=this.get(2,2)*this.get(0,3),u=this.get(0,2)*this.get(1,3),c=this.get(1,2)*this.get(0,3),d=this.get(2,0)*this.get(3,1),g=this.get(3,0)*this.get(2,1),m=this.get(1,0)*this.get(3,1),f=this.get(3,0)*this.get(1,1),p=this.get(1,0)*this.get(2,1),y=this.get(2,0)*this.get(1,1),w=this.get(0,0)*this.get(3,1),T=this.get(3,0)*this.get(0,1),v=this.get(0,0)*this.get(2,1),b=this.get(2,0)*this.get(0,1),x=this.get(0,0)*this.get(1,1),A=this.get(1,0)*this.get(0,1),R=e*this.get(1,1)+i*this.get(2,1)+n*this.get(3,1)-(t*this.get(1,1)+s*this.get(2,1)+o*this.get(3,1)),E=t*this.get(0,1)+r*this.get(2,1)+l*this.get(3,1)-(e*this.get(0,1)+a*this.get(2,1)+h*this.get(3,1)),_=s*this.get(0,1)+a*this.get(1,1)+u*this.get(3,1)-(i*this.get(0,1)+r*this.get(1,1)+c*this.get(3,1)),D=o*this.get(0,1)+h*this.get(1,1)+c*this.get(2,1)-(n*this.get(0,1)+l*this.get(1,1)+u*this.get(2,1)),S=1/(this.get(0,0)*R+this.get(1,0)*E+this.get(2,0)*_+this.get(3,0)*D),R=S*R,E=S*E,_=S*_,D=S*D,F=S*(t*this.get(1,0)+s*this.get(2,0)+o*this.get(3,0)-(e*this.get(1,0)+i*this.get(2,0)+n*this.get(3,0))),e=S*(e*this.get(0,0)+a*this.get(2,0)+h*this.get(3,0)-(t*this.get(0,0)+r*this.get(2,0)+l*this.get(3,0))),t=S*(i*this.get(0,0)+r*this.get(1,0)+c*this.get(3,0)-(s*this.get(0,0)+a*this.get(1,0)+u*this.get(3,0))),i=S*(n*this.get(0,0)+l*this.get(1,0)+u*this.get(2,0)-(o*this.get(0,0)+h*this.get(1,0)+c*this.get(2,0))),r=S*(d*this.get(1,3)+f*this.get(2,3)+p*this.get(3,3)-(g*this.get(1,3)+m*this.get(2,3)+y*this.get(3,3))),s=S*(g*this.get(0,3)+w*this.get(2,3)+b*this.get(3,3)-(d*this.get(0,3)+T*this.get(2,3)+v*this.get(3,3))),a=S*(m*this.get(0,3)+T*this.get(1,3)+x*this.get(3,3)-(f*this.get(0,3)+w*this.get(1,3)+A*this.get(3,3))),n=S*(y*this.get(0,3)+v*this.get(1,3)+A*this.get(2,3)-(p*this.get(0,3)+b*this.get(1,3)+x*this.get(2,3))),l=S*(m*this.get(2,2)+y*this.get(3,2)+g*this.get(1,2)-(p*this.get(3,2)+d*this.get(1,2)+f*this.get(2,2))),u=S*(v*this.get(3,2)+d*this.get(0,2)+T*this.get(2,2)-(w*this.get(2,2)+b*this.get(3,2)+g*this.get(0,2))),o=S*(w*this.get(1,2)+A*this.get(3,2)+f*this.get(0,2)-(x*this.get(3,2)+m*this.get(0,2)+T*this.get(1,2))),h=S*(x*this.get(2,2)+p*this.get(0,2)+b*this.get(1,2)-(v*this.get(1,2)+A*this.get(2,2)+y*this.get(0,2)));return this.elements[0]=R,this.elements[1]=E,this.elements[2]=_,this.elements[3]=D,this.elements[4]=F,this.elements[5]=e,this.elements[6]=t,this.elements[7]=i,this.elements[8]=r,this.elements[9]=s,this.elements[10]=a,this.elements[11]=n,this.elements[12]=l,this.elements[13]=u,this.elements[14]=o,this.elements[15]=h,this},inverse:function(){return this.copy().invert()},transpose:function(){var e=this.elements[1];return this.elements[1]=this.elements[4],this.elements[4]=e,e=this.elements[2],this.elements[2]=this.elements[8],this.elements[8]=e,e=this.elements[3],this.elements[3]=this.elements[12],this.elements[12]=e,e=this.elements[6],this.elements[6]=this.elements[9],this.elements[9]=e,e=this.elements[7],this.elements[7]=this.elements[13],this.elements[13]=e,e=this.elements[11],this.elements[11]=this.elements[14],this.elements[14]=e,this},loadIdentity:function(){for(var e=0;e<16;e++)this.elements[e]=0;return this.elements[0]=1,this.elements[5]=1,this.elements[10]=1,this.elements[15]=1,this}},t.exports=d},{}],3:[function(e,t,s){var R=e("./matrix4x4"),d=e("./cameracontroller"),E=0,_=0,D=0;(AnalyserView=function(e){this.analysisType=2,this.sonogram3DWidth=256,this.sonogram3DHeight=256,this.sonogram3DGeometrySize=9.5,this.freqByteData=0,this.texture=0,this.TEXTURE_HEIGHT=256,this.yoffset=0,this.frequencyShader=0,this.waveformShader=0,this.sonogramShader=0,this.sonogram3DShader=0,this.backgroundColor=[.08,.08,.08,1],this.foregroundColor=[0,.7,0,1],this.canvas=e,this.initGL()}).prototype.getAvailableContext=function(e,t){if(e.getContext)for(var s=0;s<t.length;++s)try{var i=e.getContext(t[s],{antialias:!0});if(null!==i)return i}catch(e){}return null},AnalyserView.prototype.initGL=function(){E=new R,_=new R,D=new R;var e=this.sonogram3DWidth,t=this.sonogram3DHeight,s=this.sonogram3DGeometrySize,i=this.backgroundColor,n=this.canvas,o=this.getAvailableContext(n,["webgl","experimental-webgl"]),n=(this.gl=o,this.has3DVisualizer=0<o.getParameter(o.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.has3DVisualizer||2!=this.analysisType||(this.analysisType=0),new d(n)),r=((this.cameraController=n).xRot=-180,n.yRot=270,n.zRot=90,n.xT=0,n.yT=-2,n.zT=-2,o.clearColor(i[0],i[1],i[2],i[3]),o.enable(o.DEPTH_TEST),new Float32Array([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0])),a=new Float32Array([1,1,0,1,0,0,1,1,0,0,1,0]),n=r.byteLength,i=(this.vboTexCoordOffset=n,o.createBuffer()),i=(this.vbo=i,o.bindBuffer(o.ARRAY_BUFFER,i),o.bufferData(o.ARRAY_BUFFER,n+a.byteLength,o.STATIC_DRAW),o.bufferSubData(o.ARRAY_BUFFER,0,r),o.bufferSubData(o.ARRAY_BUFFER,n,a),e*t);if(65536<i)throw"Sonogram 3D resolution is too high: can only handle 65536 vertices max";for(var r=new Float32Array(3*i),a=new Float32Array(2*i),h=0;h<t;h++)for(var l=0;l<e;l++)r[3*(e*h+l)+0]=s*(l-e/2)/e,r[3*(e*h+l)+1]=0,r[3*(e*h+l)+2]=s*(h-t/2)/t,a[2*(e*h+l)+0]=l/(e-1),a[2*(e*h+l)+1]=h/(t-1);for(var n=r.byteLength,i=(this.vbo3DTexCoordOffset=n,o.createBuffer()),i=(this.sonogram3DVBO=i,o.bindBuffer(o.ARRAY_BUFFER,i),o.bufferData(o.ARRAY_BUFFER,n+a.byteLength,o.STATIC_DRAW),o.bufferSubData(o.ARRAY_BUFFER,0,r),o.bufferSubData(o.ARRAY_BUFFER,n,a),(e-1)*(t-1)*6),u=(this.sonogram3DNumIndices=i-3600,new Uint16Array(i)),c=0,h=0;h<t-1;h++)for(l=0;l<e-1;l++)u[c++]=h*e+l,u[c++]=h*e+l+1,u[c++]=(h+1)*e+l+1,u[c++]=h*e+l,u[c++]=(h+1)*e+l+1,u[c++]=(h+1)*e+l;n=o.createBuffer();this.sonogram3DIBO=n,o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,n),o.bufferData(o.ELEMENT_ARRAY_BUFFER,u,o.STATIC_DRAW),this.frequencyShader=o3djs.shader.loadFromURL(o,"bin/shaders/common-vertex.shader","bin/shaders/frequency-fragment.shader"),this.waveformShader=o3djs.shader.loadFromURL(o,"bin/shaders/common-vertex.shader","bin/shaders/waveform-fragment.shader"),this.sonogramShader=o3djs.shader.loadFromURL(o,"bin/shaders/common-vertex.shader","bin/shaders/sonogram-fragment.shader"),this.has3DVisualizer&&(this.sonogram3DShader=o3djs.shader.loadFromURL(o,"bin/shaders/sonogram-vertex.shader","bin/shaders/sonogram-fragment.shader")),console.log("this.sonogramShader",this.sonogramShader),console.log("this.sonogram3DShader",this.sonogram3DShader)},AnalyserView.prototype.initByteBuffer=function(){var e,t=this.gl,s=this.TEXTURE_HEIGHT;this.freqByteData&&this.freqByteData.length==this.analyser.frequencyBinCount||(freqByteData=new Uint8Array(this.analyser.frequencyBinCount),this.freqByteData=freqByteData,this.texture&&(t.deleteTexture(this.texture),this.texture=null),e=t.createTexture(),this.texture=e,t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),e=new Uint8Array(freqByteData.length*s),t.texImage2D(t.TEXTURE_2D,0,t.ALPHA,freqByteData.length,s,0,t.ALPHA,t.UNSIGNED_BYTE,e))},AnalyserView.prototype.setAnalysisType=function(e){!this.has3DVisualizer&&2==e||(this.analysisType=e)},AnalyserView.prototype.analysisType=function(){return this.analysisType},AnalyserView.prototype.doFrequencyAnalysis=function(e){var t=this.freqByteData;switch(this.analysisType){case 0:this.analyser.smoothingTimeConstant=.75,this.analyser.getByteFrequencyData(t);break;case 1:case 2:this.analyser.smoothingTimeConstant=0,this.analyser.getByteFrequencyData(t);break;case 3:this.analyser.smoothingTimeConstant=.1,this.analyser.getByteTimeDomainData(t)}this.drawGL()},AnalyserView.prototype.drawGL=function(){var e,t,s,i,n,o,r=this.canvas,a=this.gl,h=this.vbo,l=this.vboTexCoordOffset,u=this.sonogram3DVBO,c=this.vbo3DTexCoordOffset,d=this.sonogram3DGeometrySize,g=this.sonogram3DNumIndices,m=(this.sonogram3DWidth,this.sonogram3DHeight),f=this.freqByteData,p=this.texture,y=this.TEXTURE_HEIGHT,w=this.frequencyShader,T=this.waveformShader,v=this.sonogramShader,b=this.sonogram3DShader,x=(a.bindTexture(a.TEXTURE_2D,p),a.pixelStorei(a.UNPACK_ALIGNMENT,1),1!=this.analysisType&&2!=this.analysisType&&(this.yoffset=0),a.texSubImage2D(a.TEXTURE_2D,0,0,this.yoffset,f.length,1,a.ALPHA,a.UNSIGNED_BYTE,f),1!=this.analysisType&&2!=this.analysisType||(this.yoffset=(this.yoffset+1)%y),this.yoffset);switch(this.analysisType){case 0:case 3:a.bindBuffer(a.ARRAY_BUFFER,h),(A=0==this.analysisType?w:T).bind(),e=A.gPositionLoc,t=A.gTexCoord0Loc,s=A.frequencyDataLoc,i=A.foregroundColorLoc,n=A.backgroundColorLoc,a.uniform1f(A.yoffsetLoc,.5/(y-1)),o=l;break;case 1:a.bindBuffer(a.ARRAY_BUFFER,h),v.bind(),e=v.gPositionLoc,t=v.gTexCoord0Loc,s=v.frequencyDataLoc,i=v.foregroundColorLoc,n=v.backgroundColorLoc,a.uniform1f(v.yoffsetLoc,x/(y-1)),o=l;break;case 2:a.bindBuffer(a.ARRAY_BUFFER,u),b.bind(),e=b.gPositionLoc,t=b.gTexCoord0Loc,s=b.frequencyDataLoc,i=b.foregroundColorLoc,n=b.backgroundColorLoc,a.uniform1i(b.vertexFrequencyDataLoc,0);var A=this.yoffset/(y-1),A=(a.uniform1f(b.yoffsetLoc,A),Math.floor(A*(m-1))/(m-1)),A=(a.uniform1f(b.vertexYOffsetLoc,A),a.uniform1f(b.verticalScaleLoc,d/3.5),D.loadIdentity(),D.perspective(55,r.width/r.height,1,100),_.loadIdentity(),_.translate(0,0,-9),E.loadIdentity(),E.rotate(this.cameraController.xRot,1,0,0),E.rotate(this.cameraController.yRot,0,1,0),E.rotate(this.cameraController.zRot,0,0,1),E.translate(this.cameraController.xT,this.cameraController.yT,this.cameraController.zT),new R);A.multiply(E),A.multiply(_),A.multiply(D),a.uniformMatrix4fv(b.worldViewProjectionLoc,a.FALSE,A.elements),o=c}s&&a.uniform1i(s,0),i&&a.uniform4fv(i,this.foregroundColor),n&&a.uniform4fv(n,this.backgroundColor),a.enableVertexAttribArray(e),a.vertexAttribPointer(e,3,a.FLOAT,!1,0,0),a.enableVertexAttribArray(t),a.vertexAttribPointer(t,2,a.FLOAT,a.FALSE,0,o),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),0==this.analysisType||3==this.analysisType||1==this.analysisType?a.drawArrays(a.TRIANGLES,0,6):2==this.analysisType&&a.drawElements(a.TRIANGLES,g,a.UNSIGNED_SHORT,0),a.disableVertexAttribArray(e),a.disableVertexAttribArray(t)},AnalyserView.prototype.setAnalyserNode=function(e){this.analyser=e},t.exports=AnalyserView},{"./cameracontroller":1,"./matrix4x4":2}],4:[function(e,t,s){var i=e("../util/util.js");function n(){window.AudioContext=window.AudioContext||window.webkitAudioContext;var e=(context=new AudioContext).createAnalyser(),t=(e.fftSize=window.isMobile?1024:2048,e.smoothingTimeConstant=0,context.createGain()),s=context.createBiquadFilter(),s=(s.Q.value=10,s.type="bandpass",context.createGain());s.gain.value=1,t.connect(e),e.connect(s),s.connect(context.destination),this.context=context,this.mix=t,this.filterGain=s,this.analyser=e,this.buffers={},i.loadTrackSrc(this.context,"bin/snd/empty.mp3",function(e){e=this.createSource_(e,!0);e.loop=!0,e.start(0)}.bind(this))}n.prototype.playSrc=function(t){this.filterGain.gain.value=1,this.input?(this.input.disconnect(),this.input=null):this.buffers[t]?($("#loadingSound").fadeIn(100).delay(1e3).fadeOut(500),this.playHelper_(t)):($("#loadingSound").fadeIn(100),i.loadTrackSrc(this.context,t,function(e){this.buffers[t]=e,this.playHelper_(t),$("#loadingSound").delay(500).fadeOut(500)}.bind(this)))},n.prototype.playUserAudio=function(e){this.filterGain.gain.value=1,this.input?(this.input.disconnect(),this.input=null):(this.buffers.user=e.buffer,this.playHelper_("user"))},n.prototype.playHelper_=function(e){e=this.buffers[e];this.source=this.createSource_(e,!0),this.source.start(0),this.loop||(this.playTimer=setTimeout(function(){this.stop()}.bind(this),2e3*e.duration))},n.prototype.live=function(){var t;"suspended"===this.context.state&&this.context.resume(),window.isIOS?(window.parent.postMessage("error2","*"),console.log("cant use mic on ios")):this.input?(this.input.disconnect(),this.input=null):(t=this,navigator.mediaDevices.getUserMedia({audio:!0}).then(function(e){t.onStream_(e)}).catch(function(){t.onStreamError(this)}),this.filterGain.gain.value=0)},n.prototype.onStream_=function(e){var t=this.context.createMediaStreamSource(e);t.connect(this.mix),this.input=t,this.stream=e},n.prototype.onStreamError_=function(e){},n.prototype.setLoop=function(e){this.loop=e},n.prototype.createSource_=function(e,t){var s=this.context.createBufferSource();return s.buffer=e,s.loop=t,s.connect(this.mix),s},n.prototype.setMicrophoneInput=function(){},n.prototype.stop=function(){this.source&&(this.source.stop(0),this.source=null,clearTimeout(this.playTimer),this.playTimer=null),this.input&&(this.input.disconnect(),this.input=null)},n.prototype.getAnalyserNode=function(){return this.analyser},n.prototype.setBandpassFrequency=function(e){(null==e?(console.log("Removing bandpass filter"),this.mix.disconnect(),this.mix):(this.bandpass.frequency.value=e,this.mix.disconnect(),this.mix.connect(this.bandpass),this.filterGain)).connect(this.analyser)},n.prototype.playTone=function(e){this.osc||(this.osc=this.context.createOscillator(),this.osc.connect(this.mix),this.osc.type="sine",this.osc.start(0)),this.osc.frequency.value=e,this.filterGain.gain.value=.2},n.prototype.stopTone=function(){this.osc.stop(0),this.osc=null},t.exports=n},{"../util/util.js":7}],5:[function(e,t,s){"use strict";var i=e("../util/util.js"),n=e("../UI/player"),o=e("../3D/visualizer"),r={cxRot:90,drawingMode:!1,prevX:0,handleTrack:function(e){switch(e.type){case"mousedown":case"touchstart":return r.prevX=Number(e.pageX)||Number(e.originalEvent.touches[0].pageX),$(e.currentTarget).on("mousemove",r.handleTrack),$(e.currentTarget).on("touchmove",r.handleTrack),0!=r.drawingMode&&(s=r.yToFreq(Number(e.pageY)||Number(e.originalEvent.touches[0].pageY)),r.isPlaying()?r.player.setBandpassFrequency(s):r.player.playTone(s)),!1;case"mousemove":case"touchmove":var t,s,i=(Number(e.pageX)||Number(e.originalEvent.touches[0].pageX))-r.prevX;return r.prevX=Number(e.pageX)||Number(e.originalEvent.touches[0].pageX),r.drawingMode?(t=Number(e.pageY)||Number(e.originalEvent.touches[0].pageY),s=r.yToFreq(t),r.isPlaying()?r.player.setBandpassFrequency(s):r.player.playTone(s)):r.isPlaying()&&(r.cxRot+=.2*i,r.cxRot<0?r.cxRot=0:90<r.cxRot&&(r.cxRot=90)),!1;case"mouseup":case"touchend":return $(e.currentTarget).off("mousemove",r.handleTrack),$(e.currentTarget).off("touchmove",r.handleTrack),0!=r.drawingMode&&(r.isPlaying()?r.player.setBandpassFrequency(null):r.player.stopTone()),!1}},attached:function(){console.log("spectrogram-3d attached"),i.setLogScale(20,20,2e4,2e4),r.onResize_(),r.init_(),window.addEventListener("resize",r.onResize_.bind(r))},stop:function(){r.player.stop()},isPlaying:function(){return!!this.player.source},stopRender:function(){r.isRendering=!1},startRender:function(){r.isRendering||(r.isRendering=!0,r.draw_())},loopChanged:function(e){r.player.setLoop(e)},play:function(e){r.src=e,r.player.playSrc(e)},live:function(){r.player.live()},userAudio:function(e){r.player.playUserAudio(e)},init_:function(){var e=new n,t=e.getAnalyserNode(),s=new o(this.canvas);s.setAnalyserNode(t),s.initByteBuffer(),r.player=e,r.analyserView=s,$("#spectrogram").on("mousedown",this.handleTrack).on("touchstart",this.handleTrack).on("mouseup",this.handleTrack).on("touchend",this.handleTrack)},onResize_:function(){console.log("onResize_");var e=$("#spectrogram")[0],e=((r.canvas=e).width=$(window).width(),e.height=$(window).height(),$("#legend")[0]);e.width=$(window).width(),e.height=$(window).height()-158,r.drawLegend_()},draw_:function(){r.isRendering?(r.analyserView.doFrequencyAnalysis(),requestAnimationFrame(r.draw_.bind(r))):console.log("stopped draw_")},drawLegend_:function(){var e=$("#legend")[0],t=e.getContext("2d"),s=e.width-10;t.fillStyle="#FFFFFF",t.font="14px Roboto",t.textAlign="right",t.textBaseline="middle",t.fillText("20,000 Hz -",s,e.height-r.freqToY(2e4)),t.fillText("2,000 Hz -",s,e.height-r.freqToY(2e3)),t.fillText("200 Hz -",s,e.height-r.freqToY(200)),t.fillText("20 Hz -",s,e.height-r.freqToY(20))},freqStart:20,freqEnd:2e4,padding:30,yToFreq:function(e){var t=r.padding,s=$("#spectrogram").height();return s<2*t||e<t||s-t<e?null:(e=r.freqStart+(r.freqEnd-r.freqStart)*(1-(e-t)/(s-t)),i.lin2log(e))},freqToY:function(e){var e=i.log2lin(e),t=$("#spectrogram").height(),s=r.padding,e=(e-r.freqStart)/(r.freqEnd-r.freqStart);return r.padding+e*(t-2*s)},easeInOutCubic:function(e,t,s,i){return(e/=i/2)<1?s/2*e*e*e+t:s/2*((e-=2)*e*e+2)+t},easeInOutQuad:function(e,t,s,i){return(e/=i/2)<1?s/2*e*e+t:-s/2*(--e*(e-2)-1)+t},easeInOutQuint:function(e,t,s,i){return(e/=i/2)<1?s/2*e*e*e*e*e+t:s/2*((e-=2)*e*e*e*e+2)+t},easeInOutExpo:function(e,t,s,i){return 0==e?t:e==i?t+s:(e/=i/2)<1?s/2*Math.pow(2,10*(e-1))+t:s/2*(2-Math.pow(2,-10*--e))+t}};t.exports=r},{"../3D/visualizer":3,"../UI/player":4,"../util/util.js":7}],6:[function(e,t,s){"use strict";window.isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),window.isIOS=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,window.isAndroid=/Android/.test(navigator.userAgent)&&!window.MSStream,window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};var l=e("./UI/spectrogram");$(function(){function t(){for(var o=null,e=n(),t="en",s=0;s<e.length;s++)null!=e[s].ln&&(t=e[s].ln);function i(){h.startRender(),h.isPlaying(),h.stop(),h.drawingMode=!1,$(".music-box__buttons__button").removeClass("selected")}$.ajax({url:"https://gweb-musiclab-site.appspot.com/static/locales/"+t+"/locale-music-lab.json",dataType:"json",async:!0,success:function(e){$.each(e,function(e,t){e=$("[data-name='"+e+"']");0<e.length&&(console.log("value.message",t.message),e.attr("data-name",t.message))})},error:function(e){console.warn(e)}}),window.parent.postMessage("ready","*");var r,a,h=l;h.attached(),$(".music-box__tool-tip").hide(0),$("#loadingSound").hide(0),$(".music-box__buttons__button").click(function(e){h.startRender();h.isPlaying();h.stop(),h.drawingMode=!1,$(this).hasClass("selected")?$(".music-box__buttons__button").removeClass("selected"):($(".music-box__buttons__button").removeClass("selected"),$(this).addClass("selected"),void 0!==$(this).attr("data-mic")?window.isIOS?(window.parent.postMessage("error2","*"),$(this).removeClass("selected")):($("#record").fadeIn().delay(2e3).fadeOut(),h.live()):void 0!==$(this).attr("data-draw")?(h.drawingMode=!0,$("#drawAnywhere").fadeIn().delay(2e3).fadeOut()):void 0!==$(this).attr("data-src")&&(h.loopChanged(!0),$("#loadingMessage").text($(this).attr("data-name")),h.play($(this).attr("data-src"))))}),window.addEventListener("blur",function(){i()}),document.addEventListener("visibilitychange",function(){i()}),r=$("#fileDrop"),a=$(".file-overlay-description"),$(window).on({dragover:function(e){e.preventDefault(),e.stopPropagation(),a.text("Drop your sound file here."),r.addClass("active")},dragleave:function(e){e.preventDefault(),e.stopPropagation(),r.removeClass("active")},drop:function(e){e.preventDefault(),e.stopPropagation(),r.addClass("pointer-events"),i();e=e.originalEvent.dataTransfer;e&&e.files.length&&e.items[0]&&"audio/midi"!==e.items[0].type?$.each(e.files,function(e,t){var s,i,n;-1<t.type.indexOf("audio")?($("#loadingMessage").text(t.name),$("#loadingSound").show(0),t=t,i=new(window.AudioContext||window.webkitAudioContext),(n=new FileReader).onload=function(e){e=e.target.result;i.decodeAudioData(e,function(e){s=e,(o=i.createBufferSource()).buffer=s,o.loop=!0,o.connect(i.destination),h.startRender(),h.loopChanged(!0),h.userAudio(o),$("#loadingSound").delay(500).fadeOut().hide(0)},function(e){console.log("Error decoding file",e)})},n.readAsArrayBuffer(t),r.removeClass("active"),r.removeClass("pointer-events")):a.text("Only sound files will work here.")}):a.text("Only sound files will work here.")}}),r.on("click",function(){r.removeClass("active"),r.removeClass("pointer-events")})}var n=function(){for(var e=window.location.search.slice(1).split("&"),t=0;t<e.length;++t){var s=e[t].split("=");e[t]={},e[t][s[0]]=s[1]}return e},s=$("#iosButton");window.isIOS?(window.parent.postMessage("loaded","*"),s[0].addEventListener("touchend",function(e){s.addClass("hide"),t()},!1)):(s.addClass("hide"),t(),console.log(2))})},{"./UI/spectrogram":5}],7:[function(e,t,s){var i=window.Util||{};i.loadTrackSrc=function(e,t,s,i){var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=function(){e.decodeAudioData(n.response,function(e){s(e)},function(e){console.error(e)})},i&&(n.onprogress=function(e){e=e.loaded/e.total;i(e)}),n.send()},i.setLogScale=function(e,t,s,i){this.b=Math.log(t/i)/(e-s),this.a=t/Math.exp(this.b*e)},i.lin2log=function(e){return this.a*Math.exp(this.b*e)},i.log2lin=function(e){return Math.log(e/this.a)/this.b},t.exports=i},{}]},{},[6]);